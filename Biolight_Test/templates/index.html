<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Dashboard Capteurs — Temps réel</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    body {
        margin: 0;
        padding: 0;
        background: #10141f;
        font-family: Arial;
        color: white;
    }

    header {
        background: #0a84ff;
        padding: 20px;
        text-align: center;
        font-size: 26px;
        font-weight: bold;
        box-shadow: 0 0 20px #0a84ff;
    }

    .container {
        width: 90%;
        margin: 30px auto;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 20px;
    }

    .card {
        background: #1b2333;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 0 15px rgba(0,0,0,0.5);
        cursor: pointer;
        transition: 0.2s;
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 0 25px #0a84ff;
    }

    .card h3 { color: #0a84ff; }

    /* ---- MODAL ---- */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0; top: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.7);
    }

    .modal-content {
        background: #1b2333;
        width: 80%;
        margin: 5% auto;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 0 20px #0a84ff;
    }

    .close {
        float: right;
        color: #fff;
        font-size: 26px;
        cursor: pointer;
    }

    canvas { width: 100% !important; height: 450px !important; }
</style>
</head>
<body>

<header>DASHBOARD CAPTEURS — TEMPS RÉEL</header>

<div class="container">

    <div class="card" onclick="openModal('m_turb')"><h3>Turbidité</h3><div id="turb">-- NTU</div></div>
    <div class="card" onclick="openModal('m_ph')"><h3>pH</h3><div id="ph">--</div></div>
    <div class="card" onclick="openModal('m_temp')"><h3>Température eau</h3><div id="temp">-- °C</div></div>
    <div class="card" onclick="openModal('m_niveau')"><h3>Niveau d'eau</h3><div id="niveau">-- %</div></div>
    <div class="card" onclick="openModal('m_debit')"><h3>Débit</h3><div id="debit">-- L/min</div></div>
    <div class="card" onclick="openModal('m_lumiere')"><h3>Luminosité</h3><div id="lumiere">-- lux</div></div>
    <div class="card" onclick="openModal('m_rotation')"><h3>Rotation</h3><div id="rotation">-- rpm</div></div>
    <div class="card" onclick="openModal('m_dht_h')"><h3>DHT22 Humidité</h3><div id="dht_h">-- %</div></div>
    <div class="card" onclick="openModal('m_dht_t')"><h3>DHT22 Température</h3><div id="dht_t">-- °C</div></div>

</div>

<!-- ---------------- MODALS + GRAPHS ---------------- -->

<div id="m_turb" class="modal"><div class="modal-content">
<span class="close" onclick="closeModal('m_turb')">&times;</span>
<h2>Turbidité</h2><canvas id="chart_turb"></canvas></div></div>

<div id="m_ph" class="modal"><div class="modal-content">
<span class="close" onclick="closeModal('m_ph')">&times;</span>
<h2>pH</h2><canvas id="chart_ph"></canvas></div></div>

<div id="m_temp" class="modal"><div class="modal-content">
<span class="close" onclick="closeModal('m_temp')">&times;</span>
<h2>Température eau</h2><canvas id="chart_temp"></canvas></div></div>

<div id="m_niveau" class="modal"><div class="modal-content">
<span class="close" onclick="closeModal('m_niveau')">&times;</span>
<h2>Niveau d'eau</h2><canvas id="chart_niveau"></canvas></div></div>

<div id="m_debit" class="modal"><div class="modal-content">
<span class="close" onclick="closeModal('m_debit')">&times;</span>
<h2>Débit</h2><canvas id="chart_debit"></canvas></div></div>

<div id="m_lumiere" class="modal"><div class="modal-content">
<span class="close" onclick="closeModal('m_lumiere')">&times;</span>
<h2>Luminosité</h2><canvas id="chart_lumiere"></canvas></div></div>

<div id="m_rotation" class="modal"><div class="modal-content">
<span class="close" onclick="closeModal('m_rotation')">&times;</span>
<h2>Rotation</h2><canvas id="chart_rotation"></canvas></div></div>

<div id="m_dht_h" class="modal"><div class="modal-content">
<span class="close" onclick="closeModal('m_dht_h')">&times;</span>
<h2>DHT22 Humidité</h2><canvas id="chart_dht_h"></canvas></div></div>

<div id="m_dht_t" class="modal"><div class="modal-content">
<span class="close" onclick="closeModal('m_dht_t')">&times;</span>
<h2>DHT22 Température</h2><canvas id="chart_dht_t"></canvas></div></div>

<script>

function openModal(id){ document.getElementById(id).style.display="block"; }
function closeModal(id){ document.getElementById(id).style.display="none"; }

// ---- CREATION DES GRAPHES ----
function createGraph(canvasId, label, color){
    return new Chart(document.getElementById(canvasId), {
        type: "line",
        data: { labels: [], datasets: [{ label: label, data: [], borderColor: color, tension: 0.3 }] },
        options: { scales: { y: { beginAtZero: false } } }
    });
}

let g_turb = createGraph("chart_turb", "Turbidité (NTU)", "#0a84ff");
let g_ph = createGraph("chart_ph", "pH", "#0a84ff");
let g_temp = createGraph("chart_temp", "Température (°C)", "#0a84ff");
let g_niveau = createGraph("chart_niveau", "Niveau (%)", "#0a84ff");
let g_debit = createGraph("chart_debit", "Débit (L/min)", "#0a84ff");
let g_lumiere = createGraph("chart_lumiere", "Lumière (lux)", "#0a84ff");
let g_rotation = createGraph("chart_rotation", "Rotation (rpm)", "#0a84ff");
let g_dht_h = createGraph("chart_dht_h", "Humidité (%)", "#0a84ff");
let g_dht_t = createGraph("chart_dht_t", "Température (°C)", "#0a84ff");

// ---- SIMULATION TEMPS REEL ----
function simulate(){
    return {
        turb: (Math.random()*50).toFixed(1),
        ph: (6+Math.random()*2).toFixed(2),
        temp: (18+Math.random()*10).toFixed(1),
        niveau: (Math.random()*100).toFixed(0),
        debit: (Math.random()*20).toFixed(1),
        lumiere: (Math.random()*1000).toFixed(0),
        rotation: (Math.random()*500).toFixed(0),
        dht_h: (40+Math.random()*30).toFixed(1),
        dht_t: (20+Math.random()*10).toFixed(1),
    };
}

function pushData(graph, value){
    const t = new Date().toLocaleTimeString();
    graph.data.labels.push(t);
    graph.data.datasets[0].data.push(value);

    if(graph.data.labels.length > 20){
        graph.data.labels.shift();
        graph.data.datasets[0].data.shift();
    }
    graph.update();
}

function update(){
    const d = simulate();

    turb.innerHTML = d.turb + " NTU";
    ph.innerHTML = d.ph;
    temp.innerHTML = d.temp + " °C";
    niveau.innerHTML = d.niveau + " %";
    debit.innerHTML = d.debit + " L/min";
    lumiere.innerHTML = d.lumiere + " lux";
    rotation.innerHTML = d.rotation + " rpm";
    dht_h.innerHTML = d.dht_h + " %";
    dht_t.innerHTML = d.dht_t + " °C";

    pushData(g_turb, d.turb);
    pushData(g_ph, d.ph);
    pushData(g_temp, d.temp);
    pushData(g_niveau, d.niveau);
    pushData(g_debit, d.debit);
    pushData(g_lumiere, d.lumiere);
    pushData(g_rotation, d.rotation);
    pushData(g_dht_h, d.dht_h);
    pushData(g_dht_t, d.dht_t);
}

setInterval(update, 1000);

</script>

</body>
</html>
